{"version":3,"sources":["file:///E:/marchine%20learning/projects/NewProject/assets/scripts/GameDataModel.ts"],"names":["_decorator","CardState","CardType","ccclass","property","GameDataModel","mainCards","bottomCards","reserveCards","isWin","isGameOver","initGame","bottomCard","createCard","NUMBER","UNLOCK","push","mainValues","forEach","val","index","card","reserveValues","COVER","console","log","length","id","type","value","state","pile","cardPile","checkMatch","selectedCard","isMatch","message","diff","Math","abs","updateBottomCard","removeMainCard","checkWinCondition","newCard","filter","c","every","checkGameOver"],"mappings":"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","sourcesContent":["import { _decorator, Component, Node } from 'cc';\r\nimport { CardModel, CardState, CardType } from './CardModel';\r\nconst { ccclass, property } = _decorator;\r\n\r\n// 简化的CardData类型（兼容视图层）\r\nexport type CardData = {\r\n    id: number;\r\n    type: CardType;\r\n    value: number;\r\n    state: CardState;\r\n    cardPile: string;\r\n}\r\n\r\n// 匹配结果类型\r\nexport type MatchResult = {\r\n    isMatch: boolean;\r\n    message: string;\r\n}\r\n\r\n// 游戏数据模型（全局牌堆+规则管理）\r\n@ccclass('GameDataModel')\r\nexport class GameDataModel {\r\n    // 三大牌堆\r\n    mainCards: CardData[] = [];    // 主牌堆（可消除的核心牌）\r\n    bottomCards: CardData[] = [];  // 底牌堆（匹配基准，仅1张）\r\n    reserveCards: CardData[] = []; // 备用牌堆（匹配失败时抽牌）\r\n\r\n    // 游戏状态\r\n    isWin: boolean = false;\r\n    isGameOver: boolean = false;\r\n\r\n    // 初始化游戏：生成所有牌堆\r\n    initGame() {\r\n        // 清空旧数据\r\n        this.mainCards = [];\r\n        this.bottomCards = [];\r\n        this.reserveCards = [];\r\n\r\n        // 1. 生成底牌（1张数字牌，解锁态）\r\n        const bottomCard = this.createCard(0, CardType.NUMBER, 5, CardState.UNLOCK, \"bottom\");\r\n        this.bottomCards.push(bottomCard);\r\n\r\n        // 2. 生成主牌堆（7张数字牌，解锁态，都是5的±1相关）\r\n        const mainValues = [4, 6, 3, 7, 8, 2, 1]; \r\n        mainValues.forEach((val, index) => {\r\n            const card = this.createCard(index + 1, CardType.NUMBER, val, CardState.UNLOCK, \"main\");\r\n            this.mainCards.push(card);\r\n        });\r\n\r\n        // 3. 生成备用牌堆（5张数字牌，覆盖态）\r\n        const reserveValues = [9, 10, 11, 12, 13];\r\n        reserveValues.forEach((val, index) => {\r\n            const card = this.createCard(index + 8, CardType.NUMBER, val, CardState.COVER, \"reserve\");\r\n            this.reserveCards.push(card);\r\n        });\r\n\r\n        console.log(\"游戏初始化完成：主牌\" + this.mainCards.length + \"张，底牌1张，备用牌\" + this.reserveCards.length + \"张\");\r\n    }\r\n\r\n    // 生成单张牌（封装逻辑）\r\n    private createCard(id: number, type: CardType, value: number, state: CardState, pile: string): CardData {\r\n        return {\r\n            id: id,\r\n            type: type,\r\n            value: value,\r\n            state: state,\r\n            cardPile: pile\r\n        };\r\n    }\r\n\r\n    // 核心匹配规则：数字牌需与底牌±1\r\n    checkMatch(selectedCard: CardData): MatchResult {\r\n        if (this.isGameOver) return { isMatch: false, message: \"游戏已结束\" };\r\n        \r\n        const bottomCard = this.bottomCards[0];\r\n        // 仅数字牌匹配规则：±1\r\n        if (selectedCard.type === CardType.NUMBER && bottomCard.type === CardType.NUMBER) {\r\n            const diff = Math.abs(selectedCard.value - bottomCard.value);\r\n            if (diff === 1) {\r\n                this.updateBottomCard(selectedCard);\r\n                this.removeMainCard(selectedCard);\r\n                this.checkWinCondition();\r\n                return { isMatch: true, message: \"数字匹配成功！\" };\r\n            }\r\n        }\r\n\r\n        return { isMatch: false, message: \"不匹配，抽备用牌！\" };\r\n    }\r\n\r\n    // 更新底牌（匹配成功后）\r\n    private updateBottomCard(newCard: CardData) {\r\n        this.bottomCards[0] = {\r\n            id: newCard.id,\r\n            type: newCard.type,\r\n            value: newCard.value,\r\n            state: CardState.UNLOCK,\r\n            cardPile: \"bottom\"\r\n        };\r\n    }\r\n\r\n    // 移除主牌堆中的牌（匹配成功后）\r\n    private removeMainCard(card: CardData) {\r\n        this.mainCards = this.mainCards.filter(c => c.id !== card.id);\r\n    }\r\n\r\n    // 检查游戏胜利条件（主牌堆为空）\r\n    checkWinCondition() {\r\n        if (this.mainCards.length === 0) {\r\n            this.isWin = true;\r\n            this.isGameOver = true;\r\n        } else if (this.reserveCards.every(c => c.state === CardState.UNLOCK)) {\r\n            // 备用牌全解锁仍未消除主牌 → 游戏失败\r\n            this.isWin = false;\r\n            this.isGameOver = true;\r\n        }\r\n    }\r\n\r\n    // 对外暴露游戏结束检查\r\n    checkGameOver(): boolean {\r\n        return this.isGameOver;\r\n    }\r\n}"]}