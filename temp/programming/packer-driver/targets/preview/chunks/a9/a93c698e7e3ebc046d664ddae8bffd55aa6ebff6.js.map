{"version":3,"sources":["file:///E:/marchine%20learning/projects/NewProject/assets/scripts/GameManager.ts"],"names":["_decorator","Component","Node","error","Button","Vec3","CardView","ccclass","property","GameManager","selectedCard","mainCards","bottomCards","bottomPileQueue","rightSingleIdx","currentBottomRightListener","start","console","log","initGame","mainCardRoot","bottomCardRoot","initMainCards","initBottomCards","children","slice","length","onBottomSingleClick","bind","updateBottomVisual","getCardValueByIndex","bottomDataList","id","value","suit","isUsed","forEach","node","index","cardView","getComponent","init","mainCardDataList","active","name","onMainCardClick","push","card","rightBottomNode","rightCardView","cardData","bottomValue","Math","abs","matchMainWithBottom","getCardViewById","highlight","markAsUsed","mainCardData","oldBottomNode","oldBottomView","mainNode","setParent","setPosition","rightSinglePos","mainCardView","find","cv","indexOf","splice","rightCard","rightBtn","interactable","shift","scheduleOnce","btn","clickEvents","off","EventType","CLICK","leftPileIds","card1","leftPilePos1","btn1","card2","leftPilePos2","btn2","on","cardId","mainCard","c","i","toString"],"mappings":"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","sourcesContent":["import { _decorator, Component, Node, error, sys, Button, Label, Vec3 } from 'cc';\r\nimport { CardView, CardData } from './CardView';\r\nconst { ccclass, property } = _decorator;\r\n\r\ndeclare const CC_EDITOR: boolean;\r\n\r\n@ccclass('GameManager')\r\nexport class GameManager extends Component {\r\n    @property(Node)\r\n    mainCardRoot: Node = null!;\r\n    @property(Node)\r\n    bottomCardRoot: Node = null!;\r\n\r\n    @property(Vec3)\r\n    rightSinglePos = new Vec3(200, 0, 0);\r\n    @property(Vec3)\r\n    leftPilePos1 = new Vec3(-200, 0, 0);\r\n    @property(Vec3)\r\n    leftPilePos2 = new Vec3(-100, 0, 0);\r\n\r\n    // æ ¸å¿ƒçŠ¶æ€\r\n    private selectedCard: CardData | null = null;\r\n    private mainCards: CardView[] = [];\r\n    private bottomCards: Node[] = [];\r\n    private bottomPileQueue: number[] = [];\r\n    private rightSingleIdx: number = 2;\r\n\r\n    // ç”¨äºç§»é™¤äº‹ä»¶ç›‘å¬çš„å‡½æ•°å¼•ç”¨\r\n    private currentBottomRightListener: (...args: any[]) => void = null!;\r\n\r\n    start() {\r\n        console.log(\"ğŸ® æ¸¸æˆåˆå§‹åŒ–...\");\r\n        this.initGame();\r\n    }\r\n\r\n    private initGame() {\r\n        if (!this.mainCardRoot) { error(\"âŒ æœªç»‘å®šmainCardRootï¼\"); return; }\r\n        if (!this.bottomCardRoot) { error(\"âŒ æœªç»‘å®šbottomCardRootï¼\"); return; }\r\n\r\n        this.initMainCards();\r\n        this.initBottomCards(); // ğŸ”¥ æ–°å¢ï¼šåˆå§‹åŒ–åº•ç‰Œæ•°æ®\r\n\r\n        this.bottomCards = this.bottomCardRoot.children.slice(0, 3);\r\n        if (this.bottomCards.length < 3) {\r\n            error(\"âŒ BottomCardRootä¸‹ä¸è¶³3ä¸ªåº•ç‰ŒèŠ‚ç‚¹ï¼\");\r\n            return;\r\n        }\r\n\r\n        // é˜Ÿåˆ—åˆå§‹åŒ–ï¼šå³ä¾§ä¸º6ï¼ˆç´¢å¼•2ï¼‰ï¼Œå·¦ä¾§ä¸º3ã€Kï¼ˆç´¢å¼•0,1ï¼‰\r\n        this.rightSingleIdx = 2;\r\n        this.bottomPileQueue = [this.rightSingleIdx, 0, 1];\r\n\r\n        this.currentBottomRightListener = this.onBottomSingleClick.bind(this);\r\n        this.updateBottomVisual();\r\n        console.log(\"âœ… åˆå§‹åŒ–å®Œæˆ | å³ä¾§åº•ç‰Œï¼š\", this.getCardValueByIndex(this.rightSingleIdx));\r\n    }\r\n\r\n    // ğŸ”¥ æ–°å¢ï¼šåˆå§‹åŒ–åº•ç‰ŒèŠ‚ç‚¹çš„ CardView æ•°æ®\r\n    private initBottomCards() {\r\n        const bottomDataList: CardData[] = [\r\n            { id: 201, value: 3, suit: 'heart', isUsed: false },\r\n            { id: 202, value: 13, suit: 'diamond', isUsed: false }, // K = 13\r\n            { id: 203, value: 6, suit: 'spade', isUsed: false }\r\n        ];\r\n\r\n        this.bottomCardRoot.children.slice(0, 3).forEach((node, index) => {\r\n            const cardView = node.getComponent(CardView);\r\n            if (cardView) {\r\n                cardView.init(bottomDataList[index], null); // åº•ç‰Œä¸éœ€è¦ç‚¹å‡»å›è°ƒ\r\n            }\r\n        });\r\n    }\r\n\r\n    private initMainCards() {\r\n        const mainCardDataList: CardData[] = [\r\n            { id: 101, value: 2, suit: 'spade', isUsed: false },\r\n            { id: 102, value: 3, suit: 'heart', isUsed: false },\r\n            { id: 103, value: 4, suit: 'club', isUsed: false },\r\n            { id: 104, value: 5, suit: 'diamond', isUsed: false },\r\n            { id: 105, value: 6, suit: 'spade', isUsed: false },\r\n            { id: 106, value: 7, suit: 'heart', isUsed: false }\r\n        ];\r\n\r\n        this.mainCardRoot.children.forEach((node, index) => {\r\n            node.active = true;\r\n            const cardView = node.getComponent(CardView);\r\n            if (!cardView) { error(`âŒ ä¸»ç‰Œ${node.name}æ— CardViewï¼`); return; }\r\n            if (index >= mainCardDataList.length) { error(`âŒ ä¸»ç‰Œ${node.name}æ— æ•°æ®ï¼`); return; }\r\n            \r\n            cardView.init(mainCardDataList[index], this.onMainCardClick.bind(this));\r\n            this.mainCards.push(cardView);\r\n        });\r\n    }\r\n\r\n    // ---------- ä¸»ç‰Œç‚¹å‡»é€»è¾‘ï¼ˆæ–°å¢åº•ç‰ŒåŒ¹é…ï¼‰----------\r\n    private onMainCardClick(card: CardData) {\r\n        console.log(`ğŸ–±ï¸ ç‚¹å‡»ä¸»ç‰Œï¼š${card.value}`);\r\n        if (card.isUsed) { console.log(`âš ï¸ ä¸»ç‰Œ${card.value}å·²ä½¿ç”¨ï¼`); return; }\r\n\r\n        // ========== æ–°å¢ï¼šä¸å³ä¾§åº•ç‰ŒåŒ¹é… ==========\r\n        const rightBottomNode = this.bottomCards[this.rightSingleIdx];\r\n        const rightCardView = rightBottomNode.getComponent(CardView);\r\n        if (rightCardView && !rightCardView.cardData.isUsed) {\r\n            const bottomValue = rightCardView.cardData.value;\r\n            if (Math.abs(card.value - bottomValue) <= 1) { // ç›¸å·® â‰¤1 å³åŒ¹é…\r\n                console.log(`ğŸ‰ ä¸»ç‰Œä¸åº•ç‰ŒåŒ¹é…æˆåŠŸï¼š${card.value} â†” ${bottomValue}`);\r\n                this.matchMainWithBottom(card, rightBottomNode, rightCardView);\r\n                return; // åŒ¹é…å®Œæˆåä¸å†æ‰§è¡Œä¸»ç‰Œé—´åŒ¹é…\r\n            }\r\n        }\r\n        // ========================================\r\n\r\n        // åŸæœ‰ä¸»ç‰Œé—´åŒ¹é…é€»è¾‘ï¼ˆä¿æŒä¸å˜ï¼‰\r\n        if (!this.selectedCard) {\r\n            this.selectedCard = card;\r\n            this.getCardViewById(card.id)?.highlight(true);\r\n            console.log(`âœ… é€‰ä¸­ä¸»ç‰Œï¼š${card.value}`);\r\n            return;\r\n        }\r\n\r\n        if (this.selectedCard.id === card.id) {\r\n            this.getCardViewById(card.id)?.highlight(false);\r\n            this.selectedCard = null;\r\n            console.log(`âŒ å–æ¶ˆé€‰ä¸­ä¸»ç‰Œï¼š${card.value}`);\r\n            return;\r\n        }\r\n\r\n        if (Math.abs(this.selectedCard.value - card.value) === 1) {\r\n            this.getCardViewById(this.selectedCard.id)?.markAsUsed();\r\n            this.getCardViewById(card.id)?.markAsUsed();\r\n            console.log(`ğŸ‰ ä¸»ç‰Œé—´åŒ¹é…æˆåŠŸï¼š${this.selectedCard.value} + ${card.value}`);\r\n        } else {\r\n            console.log(`âŒ åŒ¹é…å¤±è´¥ï¼šå·®å€¼=${Math.abs(this.selectedCard.value - card.value)}`);\r\n            this.getCardViewById(this.selectedCard.id)?.highlight(false);\r\n        }\r\n        this.selectedCard = null;\r\n    }\r\n\r\n    // ğŸ”¥ æ–°å¢ï¼šä¸»ç‰Œä¸åº•ç‰ŒåŒ¹é…æˆåŠŸåçš„å¤„ç†\r\n    private matchMainWithBottom(mainCardData: CardData, oldBottomNode: Node, oldBottomView: CardView) {\r\n        // 1. éšè—åŸåº•ç‰Œ\r\n        oldBottomNode.active = false;\r\n\r\n        // 2. è·å–ä¸»ç‰ŒèŠ‚ç‚¹å¹¶ç§»åŠ¨åˆ°åº•ç‰ŒåŒº\r\n        const mainNode = this.getCardViewById(mainCardData.id)?.node;\r\n        if (!mainNode) { error(\"âŒ ä¸»ç‰ŒèŠ‚ç‚¹ä¸å­˜åœ¨ï¼\"); return; }\r\n\r\n        mainNode.setParent(this.bottomCardRoot);\r\n        mainNode.setPosition(this.rightSinglePos);\r\n\r\n        // 3. æ›¿æ¢åº•ç‰Œæ•°ç»„ä¸­çš„å¼•ç”¨\r\n        this.bottomCards[this.rightSingleIdx] = mainNode;\r\n\r\n        // 4. ä»ä¸»ç‰Œåˆ—è¡¨ä¸­ç§»é™¤è¯¥CardViewï¼ˆå› ä¸ºå®ƒå·²ç»å˜æˆäº†åº•ç‰Œï¼‰\r\n        const mainCardView = this.mainCards.find(cv => cv.cardData.id === mainCardData.id);\r\n        if (mainCardView) {\r\n            const index = this.mainCards.indexOf(mainCardView);\r\n            if (index > -1) this.mainCards.splice(index, 1);\r\n        }\r\n\r\n        // 5. æ›´æ–°ä¸»ç‰ŒèŠ‚ç‚¹çš„CardViewæ•°æ®ï¼ˆå¯é€‰ï¼Œä½†ä¸ºäº†ç»Ÿä¸€å¤„ç†ï¼Œå¯ä¿æŒåŸæœ‰æ•°æ®ä¸å˜ï¼‰\r\n        //    æ³¨æ„ï¼šç§»åŠ¨åçš„èŠ‚ç‚¹ä»ä¿æœ‰åŸæ¥çš„CardViewç»„ä»¶ï¼Œå…¶cardData.valueä»æ˜¯åŸä¸»ç‰Œå€¼ï¼Œæ— éœ€ä¿®æ”¹ã€‚\r\n\r\n        // 6. åˆ·æ–°åº•ç‰Œæ˜¾ç¤ºï¼šè¿™ä¼šé‡æ–°æ¿€æ´»å³ä¾§èŠ‚ç‚¹å¹¶ç»‘å®šç‚¹å‡»äº‹ä»¶\r\n        this.updateBottomVisual();\r\n\r\n        // 7. é‡ç½®ä¸»ç‰Œé€‰ä¸­çŠ¶æ€ï¼ˆé˜²æ­¢æ®‹ç•™é«˜äº®ï¼‰\r\n        if (this.selectedCard && this.selectedCard.id === mainCardData.id) {\r\n            this.selectedCard = null;\r\n        }\r\n    }\r\n\r\n    // ---------- åº•ç‰Œç‚¹å‡»é€»è¾‘ï¼ˆé˜Ÿåˆ—åˆ‡æ¢ï¼‰----------\r\n    private onBottomSingleClick() {\r\n        const rightCard = this.bottomCards[this.rightSingleIdx];\r\n        const rightBtn = rightCard.getComponent(Button);\r\n        if (rightBtn) rightBtn.interactable = false; // ç«‹å³é˜²è¿ç‚¹\r\n\r\n        console.log(`ğŸ–±ï¸ ç‚¹å‡»å³ä¾§åº•ç‰Œï¼š`, this.getCardValueByIndex(this.rightSingleIdx));\r\n\r\n        // é˜Ÿåˆ—ç§»ä½\r\n        this.bottomPileQueue.shift();\r\n        this.bottomPileQueue.push(this.rightSingleIdx);\r\n        this.rightSingleIdx = this.bottomPileQueue[0];\r\n\r\n        this.scheduleOnce(() => {\r\n            this.updateBottomVisual();\r\n        }, 0);\r\n    }\r\n\r\n    private updateBottomVisual() {\r\n        // 1. éšè—æ‰€æœ‰åº•ç‰Œï¼Œç§»é™¤æ—§ç›‘å¬\r\n        this.bottomCards.forEach(card => {\r\n            card.active = false;\r\n            const btn = card.getComponent(Button);\r\n            if (btn) {\r\n                btn.clickEvents = [];\r\n                btn.node.off(Button.EventType.CLICK, this.currentBottomRightListener, this);\r\n                btn.interactable = false;\r\n            }\r\n        });\r\n\r\n        // 2. æ˜¾ç¤ºå·¦ä¾§ä¸¤å †ï¼ˆå›ºå®šä¸å¯ç‚¹å‡»ï¼‰\r\n        const leftPileIds = this.bottomPileQueue.slice(1);\r\n        if (leftPileIds.length >= 1) {\r\n            const card1 = this.bottomCards[leftPileIds[0]];\r\n            card1.active = true;\r\n            card1.setPosition(this.leftPilePos1);\r\n            const btn1 = card1.getComponent(Button);\r\n            if (btn1) {\r\n                btn1.interactable = false;\r\n                btn1.clickEvents = [];\r\n            }\r\n        }\r\n        if (leftPileIds.length >= 2) {\r\n            const card2 = this.bottomCards[leftPileIds[1]];\r\n            card2.active = true;\r\n            card2.setPosition(this.leftPilePos2);\r\n            const btn2 = card2.getComponent(Button);\r\n            if (btn2) {\r\n                btn2.interactable = false;\r\n                btn2.clickEvents = [];\r\n            }\r\n        }\r\n\r\n        // 3. æ˜¾ç¤ºå³ä¾§å•ç‰Œï¼Œç»‘å®šç‚¹å‡»äº‹ä»¶\r\n        const rightCard = this.bottomCards[this.rightSingleIdx];\r\n        rightCard.active = true;\r\n        rightCard.setPosition(this.rightSinglePos);\r\n        const rightBtn = rightCard.getComponent(Button);\r\n        if (rightBtn) {\r\n            rightBtn.node.off(Button.EventType.CLICK, this.currentBottomRightListener, this);\r\n            rightBtn.node.on(Button.EventType.CLICK, this.currentBottomRightListener, this);\r\n            rightBtn.interactable = true;\r\n            rightBtn.clickEvents = [];\r\n        }\r\n    }\r\n\r\n    // ---------- å·¥å…·æ–¹æ³• ----------\r\n    private getCardViewById(cardId: number): CardView | null {\r\n        const mainCard = this.mainCards.find(c => c.cardData.id === cardId);\r\n        if (mainCard) return mainCard;\r\n\r\n        for (let i = 0; i < this.bottomCards.length; i++) {\r\n            const cardView = this.bottomCards[i].getComponent(CardView);\r\n            if (cardView && cardView.cardData.id === cardId) return cardView;\r\n        }\r\n        error(`âŒ æœªæ‰¾åˆ°å¡ç‰ŒIDï¼š${cardId}`);\r\n        return null;\r\n    }\r\n\r\n    private getCardValueByIndex(index: number): string {\r\n        const cardView = this.bottomCards[index]?.getComponent(CardView);\r\n        return cardView ? cardView.cardData.value.toString() : '?';\r\n    }\r\n}"]}