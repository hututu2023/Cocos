{"version":3,"sources":["file:///E:/marchine%20learning/projects/NewProject/assets/scripts/CardView.ts"],"names":["_decorator","Component","Sprite","Button","EventHandler","ccclass","property","CardView","cardData","onClickCallback","init","data","onClick","isUsed","node","active","bindButtonClick","console","log","id","button","getComponent","error","name","clickEvents","length","eventHandler","target","component","handler","push","onButtonClick","markAsUsed","opacity","resetCard","scale","highlight","isHighlight","onDestroy"],"mappings":"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","sourcesContent":["import { _decorator, Component, Node, Sprite, Button, EventHandler } from 'cc';\r\nconst { ccclass, property } = _decorator;\r\n\r\n// å¡ç‰Œæ•°æ®ç±»å‹å®šä¹‰\r\nexport type CardData = {\r\n    id: number;\r\n    value: number;\r\n    suit: string;\r\n    isUsed: boolean;\r\n}\r\n\r\n@ccclass('CardView')\r\nexport class CardView extends Component {\r\n    // å¡ç‰Œæ­£é¢ç²¾çµï¼ˆå¦‚æœéœ€è¦æ˜¾ç¤ºå¡ç‰Œå›¾ç‰‡å¯ä½¿ç”¨ï¼‰\r\n    @property(Sprite)\r\n    cardFrontSprite: Sprite = null!;\r\n\r\n    // å¡ç‰Œæ•°æ®\r\n    public cardData: CardData = null!;\r\n    // ç‚¹å‡»å›è°ƒå‡½æ•°\r\n    private onClickCallback: ((card: CardData) => void) | null = null;\r\n\r\n    /**\r\n     * åˆå§‹åŒ–å¡ç‰Œ\r\n     * @param data å¡ç‰Œæ•°æ®\r\n     * @param onClick ç‚¹å‡»å›è°ƒ\r\n     */\r\n    init(data: CardData, onClick: (card: CardData) => void) {\r\n        // èµ‹å€¼æ•°æ®å’Œå›è°ƒ\r\n        this.cardData = data;\r\n        this.onClickCallback = onClick;\r\n        this.cardData.isUsed = false;\r\n\r\n        // æ¿€æ´»èŠ‚ç‚¹\r\n        this.node.active = true;\r\n\r\n        // æ ¸å¿ƒï¼šç»‘å®šButtonç»„ä»¶çš„ç‚¹å‡»äº‹ä»¶\r\n        this.bindButtonClick();\r\n\r\n        console.log(\"ğŸ”§ å¡ç‰Œ\", data.id, \"åˆå§‹åŒ–å®Œæˆï¼Œå·²ç»‘å®šç‚¹å‡»äº‹ä»¶\");\r\n    }\r\n\r\n    /**\r\n     * ç»‘å®šButtonç»„ä»¶ç‚¹å‡»äº‹ä»¶ï¼ˆæ–¹æ¡ˆä¸€æ ¸å¿ƒï¼‰\r\n     */\r\n    private bindButtonClick() {\r\n        // è·å–èŠ‚ç‚¹ä¸Šçš„Buttonç»„ä»¶\r\n        const button = this.node.getComponent(Button);\r\n        if (!button) {\r\n            console.error(`âŒ å¡ç‰ŒèŠ‚ç‚¹ ${this.node.name} æœªæ‰¾åˆ°Buttonç»„ä»¶ï¼`);\r\n            return;\r\n        }\r\n\r\n        // æ¸…ç©ºåŸæœ‰ç‚¹å‡»äº‹ä»¶ï¼Œé¿å…é‡å¤ç»‘å®š\r\n        button.clickEvents.length = 0;\r\n\r\n        // åˆ›å»ºæ–°çš„ç‚¹å‡»äº‹ä»¶å¤„ç†å™¨\r\n        const eventHandler = new EventHandler();\r\n        eventHandler.target = this.node;       // äº‹ä»¶ç›®æ ‡èŠ‚ç‚¹ï¼ˆå½“å‰å¡ç‰Œï¼‰\r\n        eventHandler.component = 'CardView';   // ç›®æ ‡ç»„ä»¶å\r\n        eventHandler.handler = 'onButtonClick';// å›è°ƒå‡½æ•°å\r\n\r\n        // æ·»åŠ åˆ°Buttonçš„ç‚¹å‡»äº‹ä»¶åˆ—è¡¨\r\n        button.clickEvents.push(eventHandler);\r\n    }\r\n\r\n    /**\r\n     * Buttonç»„ä»¶ç‚¹å‡»å›è°ƒï¼ˆå®é™…è§¦å‘é€»è¾‘ï¼‰\r\n     */\r\n    onButtonClick() {\r\n        console.log(\"ğŸ”¥ å¡ç‰Œ\", this.cardData?.id, \"è¢«ç‚¹å‡»ï¼\");\r\n        \r\n        // é˜²å‘†æ£€æŸ¥\r\n        if (!this.cardData) {\r\n            console.log(\"âŒ å¡ç‰Œæ•°æ®æœªåˆå§‹åŒ–\");\r\n            return;\r\n        }\r\n        if (this.cardData.isUsed) {\r\n            console.log(\"âš ï¸ å¡ç‰Œ\", this.cardData.id, \"å·²ä½¿ç”¨ï¼Œè·³è¿‡ç‚¹å‡»\");\r\n            return;\r\n        }\r\n        if (!this.onClickCallback) {\r\n            console.log(\"âŒ å¡ç‰Œ\", this.cardData.id, \"ç‚¹å‡»å›è°ƒæœªç»‘å®š\");\r\n            return;\r\n        }\r\n\r\n        // è§¦å‘å›è°ƒï¼ˆè°ƒç”¨GameManagerçš„åŒ¹é…/å›é€€é€»è¾‘ï¼‰\r\n        this.onClickCallback(this.cardData);\r\n    }\r\n\r\n    /**\r\n     * æ ‡è®°å¡ç‰Œä¸ºå·²ä½¿ç”¨ï¼ˆå˜ç°ï¼‰\r\n     */\r\n    markAsUsed() {\r\n        this.cardData.isUsed = true;\r\n        this.node.opacity = 100; // é€æ˜åº¦é™ä½ï¼Œè§†è§‰ä¸Šå˜ç°\r\n        console.log(\"ğŸ¨ å¡ç‰Œ\", this.cardData.id, \"æ ‡è®°ä¸ºå·²ä½¿ç”¨\");\r\n    }\r\n\r\n    /**\r\n     * é‡ç½®å¡ç‰Œä¸ºæ­£å¸¸çŠ¶æ€\r\n     */\r\n    resetCard() {\r\n        this.cardData.isUsed = false;\r\n        this.node.opacity = 255; // æ¢å¤é€æ˜åº¦\r\n        this.node.scale = 1.0;   // æ¢å¤ç¼©æ”¾\r\n        console.log(\"ğŸ”„ å¡ç‰Œ\", this.cardData.id, \"é‡ç½®ä¸ºæ­£å¸¸çŠ¶æ€\");\r\n    }\r\n\r\n    /**\r\n     * å¡ç‰Œé«˜äº®/å–æ¶ˆé«˜äº®ï¼ˆé€‰ä¸­æ•ˆæœï¼‰\r\n     * @param isHighlight æ˜¯å¦é«˜äº®\r\n     */\r\n    highlight(isHighlight: boolean) {\r\n        if (this.cardData.isUsed) return; // å·²ä½¿ç”¨çš„å¡ç‰Œä¸é«˜äº®\r\n        this.node.scale = isHighlight ? 1.1 : 1.0; // ç¼©æ”¾å˜åŒ–å®ç°é«˜äº®\r\n        console.log(\"âœ¨ å¡ç‰Œ\", this.cardData.id, isHighlight ? \"é«˜äº®\" : \"å–æ¶ˆé«˜äº®\");\r\n    }\r\n\r\n    /**\r\n     * ç»„ä»¶é”€æ¯æ—¶æ¸…ç†äº‹ä»¶ï¼ˆé˜²æ­¢å†…å­˜æ³„æ¼ï¼‰\r\n     */\r\n    onDestroy() {\r\n        const button = this.node.getComponent(Button);\r\n        if (button) {\r\n            button.clickEvents.length = 0;\r\n        }\r\n        this.onClickCallback = null;\r\n    }\r\n}"]}